<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      xmlns:c="http://jmix.io/schema/flowui/jpql-condition"
      title="msg://VVacancySearchListView.title"
      focusComponent="vVacancySearchesDataGrid">
  <data>
    <collection id="vVacancySearchesDc"
                class="ru.mindils.jb2.app.entity.VVacancySearch">
      <fetchPlan extends="_base"/>
      <loader id="vVacancySearchesDl" readOnly="true">
        <query>
          <![CDATA[select e from jb2_VVacancySearch e order by e.score desc ]]>
        </query>
      </loader>
    </collection>
  </data>
  <facets>
    <dataLoadCoordinator auto="true"/>
    <urlQueryParameters>
      <pagination component="pagination"/>
      <propertyFilter component="idFilter" param="id"/>
      <propertyFilter component="archFilter" param="archived"/>
      <propertyFilter component="isJavaVacancyFilter" param="isJavaVacancy"/>
      <propertyFilter component="ratingFilter" param="rating"/>
      <propertyFilter component="myStatusFilter" param="myStatus"/>
      <propertyFilter component="scoreFilter" param="score"/>
    </urlQueryParameters>
  </facets>
  <actions>
    <action id="selectAction" type="lookup_select"/>
    <action id="discardAction" type="lookup_discard"/>
  </actions>
  <layout>
    <!-- Адаптивный контейнер - одна линия на десктопе, перенос на мобильных -->
    <hbox width="100%"
          css="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-start; margin-bottom: 1rem;">
      <!-- Фильтры -->
      <details summaryText="Фильтры"
               themeNames="small"
               css="flex: 1 1 auto; min-width: 300px;">
        <hbox css="display: flex; flex-wrap: wrap; gap: 0.5rem;">
          <propertyFilter
              id="idFilter"
              label="ИД Вакансии"
              property="id"
              operation="EQUAL"
              dataLoader="vVacancySearchesDl"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;"
          />
          <propertyFilter
              id="isJavaVacancyFilter"
              property="isJavaVacancy"
              operation="EQUAL"
              label="Java Вакансия"
              defaultValue="true"
              dataLoader="vVacancySearchesDl"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;"
          />
          <propertyFilter
              id="archFilter"
              label="Архив"
              property="archived"
              defaultValue="false"
              operation="EQUAL"
              dataLoader="vVacancySearchesDl"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;"
          />
          <propertyFilter
              id="ratingFilter"
              property="rating"
              operation="IN_LIST"
              dataLoader="vVacancySearchesDl"
              label="Рейтинг"
              defaultValue="EXCELLENT,GOOD,MODERATE"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;">
            <multiSelectComboBox itemsEnum="ru.mindils.jb2.app.entity.VacancyScoreRating"/>
          </propertyFilter>
          <propertyFilter
              id="myStatusFilter"
              property="myStatus"
              operation="IN_LIST"
              dataLoader="vVacancySearchesDl"
              label="Мой статус"
              defaultValue="NEW"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;">
            <multiSelectComboBox itemsEnum="ru.mindils.jb2.app.entity.VacancyStatus"/>
          </propertyFilter>
          <propertyFilter
              id="scoreFilter"
              label="Оценка ≥"
              property="score"
              operation="GREATER_OR_EQUAL"
              dataLoader="vVacancySearchesDl"
              labelPosition="TOP"
              css="flex: 1 1 180px; min-width: 120px;"
          />
          <propertyFilter
              id="myEmployerStatusFilter"
              property="myStatusEmployer"
              operation="IN_LIST"
              dataLoader="vVacancySearchesDl"
              label="Мой статус Компании"
              labelPosition="TOP"
              defaultValue="NEW,APPROVED"
              css="flex: 1 1 180px; min-width: 120px;">
            <multiSelectComboBox itemsEnum="ru.mindils.jb2.app.entity.EmployerStatus"/>
          </propertyFilter>
        </hbox>
      </details>
      <!-- Кнопка добавления в очередь -->
      <dropdownButton id="vacancyDropdown"
                      text="Добавить в очередь"
                      icon="CALC"
                      css="flex: 0 0 auto; min-width: 200px;">
        <items>
          <textItem id="updateVacancyBtn" text="Обновление"/>
          <textItem id="addVacancyInFirstLlmQueueBtn" text="Первичный анализ llm"/>
          <textItem id="addVacancyInSocialLlmQueueBtn" text="Полный анализ llm"/>
          <textItem id="calculateVacancyScoresBtn" text="Рассчитать оценки"/>
        </items>
      </dropdownButton>
      <!-- Пагинация -->
      <simplePagination id="pagination"
                        dataLoader="vVacancySearchesDl"
                        css="flex: 0 0 auto;"/>
    </hbox>
    <!-- Таблица -->
    <dataGrid id="vVacancySearchesDataGrid"
              width="100%"
              minHeight="20em"
              dataContainer="vVacancySearchesDc"
              columnReorderingAllowed="true"
              themeNames="compact">
      <actions>
        <action id="readAction" type="list_read"/>
      </actions>
      <columns resizable="true">
        <column property="id" autoWidth="true"/>
        <column property="name" autoWidth="true"/>
        <column property="myStatus" autoWidth="true"/>
        <column property="employerName" autoWidth="true"/>
        <column property="score" autoWidth="true"/>
        <column property="rating" autoWidth="true"/>
        <column property="negativeDescription"/>
        <column property="positiveDescription"/>
        <column property="isJavaVacancy" autoWidth="true"/>
        <column property="archived" autoWidth="true"/>
      </columns>
      <contextMenu>
        <item id="updateVacancyMenu" text="Обновить вакансию"/>
        <item id="firstLlmAnalyseMenu" text="Первичный анализ"/>
        <item id="fullLlmAnalyseMenu" text="Полный анализ"/>
        <item id="vacancyScoreCalculateMenu" text="Посчитать оценку"/>
      </contextMenu>
    </dataGrid>
    <hbox id="lookupActions" visible="false">
      <button id="selectButton" action="selectAction"/>
      <button id="discardButton" action="discardAction"/>
    </hbox>
  </layout>
</view>