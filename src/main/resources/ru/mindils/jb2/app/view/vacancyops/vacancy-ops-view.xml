<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://vacancyOpsView.title">
  <data>
    <collection id="workflowInfoesDc" class="ru.mindils.jb2.app.dto.WorkflowInfo">
      <loader id="workflowInfoesDl" readOnly="true"/>
      <fetchPlan extends="_base"/>
    </collection>
  </data>
  <facets>
    <dataLoadCoordinator auto="false"/>
  </facets>
  <layout>
    <vbox width="100%" height="100%" padding="true" spacing="true">

      <!-- Header -->
      <h2 text="Операции с вакансиями" css="margin-bottom: var(--lumo-space-l);"/>

      <!-- Sync Operations Card -->
      <vbox css="background: var(--lumo-contrast-5pct);
                 border-radius: var(--lumo-border-radius-l);
                 padding: var(--lumo-space-l);"
            spacing="true" width="100%">
        <h3 text="Синхронизация вакансий" css="margin: 0;"/>

        <vbox spacing="true">
          <vbox spacing="true">
            <button id="updateAllVacanciesBtn"
                    text="Обновление всех вакансий"
                    icon="REFRESH"
                    themeNames="primary"
                    width="AUTO"/>
            <p text="Полная синхронизация всех вакансий с внешним API"
               css="margin: 0; color: var(--lumo-secondary-text-color);
                    font-size: var(--lumo-font-size-s);"/>
          </vbox>

          <vbox spacing="true">
            <button id="updateFromLastLoadBtn"
                    text="Обновление с последней загрузки"
                    icon="CLOCK"
                    themeNames="contrast"
                    width="AUTO"/>
            <p text="Синхронизация только новых вакансий"
               css="margin: 0; color: var(--lumo-secondary-text-color);
                    font-size: var(--lumo-font-size-s);"/>
            <p id="lastTimeUpdateText"
               css="margin: 0; color: var(--lumo-secondary-text-color);
                    font-size: var(--lumo-font-size-s);"/>
          </vbox>
        </vbox>
      </vbox>

      <!-- Analysis Operations Accordion -->
      <vbox css="background: var(--lumo-contrast-5pct);
                 border-radius: var(--lumo-border-radius-l);
                 padding: var(--lumo-space-l);"
            spacing="true" width="100%">
        <h3 text="Анализ вакансий" css="margin: 0;"/>

        <accordion width="100%">
          <!-- Primary Analysis -->
          <accordionPanel summaryText="Первичный анализ (Java, Jmix, AI)" opened="true">
            <vbox css="padding: var(--lumo-space-m);" spacing="true">
              <hbox spacing="true" alignItems="CENTER" wrap="true">
                <button id="addToQueueBtn"
                        text="Добавить в очередь"
                        icon="PLUS"
                        themeNames="success small"/>
                <button id="processQueueBtn"
                        text="Запуск обработки"
                        icon="PLAY"
                        themeNames="primary small"/>
              </hbox>
              <p text="Анализ технологий в вакансиях"
                 css="margin: 0; color: var(--lumo-secondary-text-color);
                      font-size: var(--lumo-font-size-s);"/>
            </vbox>
          </accordionPanel>

          <!-- AI Analysis -->
          <accordionPanel summaryText="AI анализ" opened="false">
            <vbox css="padding: var(--lumo-space-m);" spacing="true">
              <hbox spacing="true" alignItems="CENTER" wrap="true">
                <button id="updateNoAiAnalysisBtn"
                        text="Обновить без AI анализа"
                        icon="AUTOMATION"
                        themeNames="contrast small"/>
                <button id="updateAiQueueBtn"
                        text="Обработать очередь"
                        icon="COG"
                        themeNames="primary small"/>
              </hbox>
              <p text="Анализ вакансий с помощью искусственного интеллекта"
                 css="margin: 0; color: var(--lumo-secondary-text-color);
                      font-size: var(--lumo-font-size-s);"/>
            </vbox>
          </accordionPanel>

          <!-- Deep Analysis -->
          <accordionPanel summaryText="Глубокий анализ" opened="false">
            <vbox css="padding: var(--lumo-space-m);" spacing="true">
              <hbox spacing="true" alignItems="CENTER" wrap="true">
                <button id="updateNoDeepAnalysisBtn"
                        text="Обновить без глубокого анализа"
                        icon="SEARCH"
                        themeNames="contrast small"/>
                <button id="processDeepQueueBtn"
                        text="Обработать очередь"
                        icon="ABACUS"
                        themeNames="primary small"/>
              </hbox>
              <p text="Детальный анализ социальных аспектов"
                 css="margin: 0; color: var(--lumo-secondary-text-color);
                      font-size: var(--lumo-font-size-s);"/>
            </vbox>
          </accordionPanel>
        </accordion>
      </vbox>

      <!-- Running Processes Card -->
      <vbox css="background: var(--lumo-contrast-5pct);
                 border-radius: var(--lumo-border-radius-l);
                 padding: var(--lumo-space-l);"
            spacing="true" width="100%">
        <hbox width="100%" justifyContent="BETWEEN" alignItems="CENTER">
          <h3 text="Запущенные процессы" css="margin: 0;"/>
          <button id="refreshProcessesBtn"
                  text="Обновить"
                  icon="REFRESH"
                  themeNames="small tertiary"/>
        </hbox>

        <!-- Process Monitor Area -->
        <vbox css="border: 1px dashed var(--lumo-contrast-30pct);
                   border-radius: var(--lumo-border-radius-m);
                   padding: var(--lumo-space-l);
                   background: var(--lumo-base-color);
                   min-height: 120px;
                   display: flex;
                   align-items: center;
                   justify-content: center;"
              id="processesContainer">
          <dataGrid id="workflowInfoesDataGrid" dataContainer="workflowInfoesDc" minWidth="100px" width="100%">
            <actions/>
            <columns>
              <column property="workflowId"/>
              <column property="workflowType"/>
              <column property="status"/>
              <column property="startTime"/>
              <column property="description"/>
              <column property="runId"/>
            </columns>
          </dataGrid>
          <icon icon="TIMER" css="color: var(--lumo-secondary-text-color); margin-bottom: var(--lumo-space-s);"/>
          <p text="Здесь будет отображаться статус запущенных процессов"
             css="color: var(--lumo-secondary-text-color);
                  font-style: italic;
                  text-align: center;
                  margin: 0;"/>

        </vbox>

        <!-- Process Stats Grid -->
        <hbox spacing="true" width="100%">
          <vbox css="background: var(--lumo-base-color);
                     border-radius: var(--lumo-border-radius-m);
                     padding: var(--lumo-space-m);
                     text-align: center;
                     flex: 1;">
            <p text="Синхронизация" css="font-weight: bold; margin: 0 0 var(--lumo-space-xs) 0;"/>
            <span id="syncProcessStatus" text="Не запущена" css="color: var(--lumo-secondary-text-color);"/>
            <span text="Последний: --" css="font-size: var(--lumo-font-size-xs); color: var(--lumo-tertiary-text-color);"/>
          </vbox>

          <vbox css="background: var(--lumo-base-color);
                     border-radius: var(--lumo-border-radius-m);
                     padding: var(--lumo-space-m);
                     text-align: center;
                     flex: 1;">
            <p text="Первичный анализ" css="font-weight: bold; margin: 0 0 var(--lumo-space-xs) 0;"/>
            <span id="primaryAnalysisStatus" text="Не запущен" css="color: var(--lumo-secondary-text-color);"/>
            <span text="В очереди: 0" css="font-size: var(--lumo-font-size-xs); color: var(--lumo-tertiary-text-color);"/>
          </vbox>

          <vbox css="background: var(--lumo-base-color);
                     border-radius: var(--lumo-border-radius-m);
                     padding: var(--lumo-space-m);
                     text-align: center;
                     flex: 1;">
            <p text="AI анализ" css="font-weight: bold; margin: 0 0 var(--lumo-space-xs) 0;"/>
            <span id="aiAnalysisStatus" text="Не запущен" css="color: var(--lumo-secondary-text-color);"/>
            <span text="Обработано: 0" css="font-size: var(--lumo-font-size-xs); color: var(--lumo-tertiary-text-color);"/>
          </vbox>

          <vbox css="background: var(--lumo-base-color);
                     border-radius: var(--lumo-border-radius-m);
                     padding: var(--lumo-space-m);
                     text-align: center;
                     flex: 1;">
            <p text="Глубокий анализ" css="font-weight: bold; margin: 0 0 var(--lumo-space-xs) 0;"/>
            <span id="deepAnalysisStatus" text="Не запущен" css="color: var(--lumo-secondary-text-color);"/>
            <span text="Прогресс: 0%" css="font-size: var(--lumo-font-size-xs); color: var(--lumo-tertiary-text-color);"/>
          </vbox>
        </hbox>
      </vbox>

      <!-- Quick Actions Accordion -->
      <accordion width="100%">
        <accordionPanel summaryText="Быстрые действия" opened="false">
          <vbox css="padding: var(--lumo-space-m);" spacing="true">
            <hbox spacing="true" wrap="true">
              <button id="stopAllProcessesBtn"
                      text="Остановить все"
                      icon="BAN"
                      themeNames="error small"/>
              <button id="clearQueuesBtn"
                      text="Очистить очереди"
                      icon="TRASH"
                      themeNames="error small"/>
              <button id="exportLogsBtn"
                      text="Экспорт логов"
                      icon="DOWNLOAD"
                      themeNames="contrast small"/>
              <button id="systemStatusBtn"
                      text="Статус системы"
                      icon="INFO"
                      themeNames="contrast small"/>
            </hbox>
          </vbox>
        </accordionPanel>
      </accordion>

    </vbox>
  </layout>
</view>